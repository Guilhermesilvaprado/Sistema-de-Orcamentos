{% extends "base.html" %}

{% block title %}{{ 'Editar Orçamento' if orcamento else 'Novo Orçamento' }} - Sistema de Orçamentos{% endblock %}

{% block content %}
<h1 class="h3 mb-3">{{ 'Editar Orçamento' if orcamento else 'Cadastro de Orçamento' }}</h1>

<form action="{{ url_for('atualizar_orcamento', orcamento_id=orcamento.id) if orcamento else url_for('criar_orcamento') }}"
      method="post" class="card p-3 shadow-sm">

    <div class="mb-3">
        <label for="cliente_id" class="form-label">Cliente *</label>
        <select id="cliente_id" name="cliente_id" class="form-select" required>
            <option value="">-- Selecione um cliente --</option>
            {% for cliente in clientes %}
            <option value="{{ cliente.id }}"
                    {% if orcamento and orcamento.cliente_id == cliente.id %}selected{% endif %}>
                {{ cliente.nome }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label for="produto_id" class="form-label">Produto *</label>
        <select id="produto_id" name="produto_id" class="form-select" required>
            <option value="">-- Selecione um produto --</option>
            {% for produto in produtos %}
            <option value="{{ produto.id }}"
                    {% if orcamento and orcamento.produto_id == produto.id %}selected{% endif %}>
                {{ produto.nome }} (R$ {{ '%.2f'|format(produto.preco_base) }})
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label for="valor_total" class="form-label">Valor Total (R$) *</label>
        <input type="number" step="0.01" min="0" id="valor_total" name="valor_total"
               class="form-control" required
               value="{{ '%.2f'|format(orcamento.valor_total) if orcamento else '' }}">
    </div>

    <div class="mb-3">
        <label for="status" class="form-label">Status *</label>
        <select id="status" name="status" class="form-select" required>
            {% set status_atual = orcamento.status if orcamento else 'Pendente' %}
            <option value="Pendente" {% if status_atual == 'Pendente' %}selected{% endif %}>Pendente</option>
            <option value="Aprovado" {% if status_atual == 'Aprovado' %}selected{% endif %}>Aprovado</option>
            <option value="Rejeitado" {% if status_atual == 'Rejeitado' %}selected{% endif %}>Rejeitado</option>
        </select>
    </div>

    <button type="submit" class="btn btn-success">Salvar</button>
    <a href="{{ url_for('listar_orcamentos') }}" class="btn btn-secondary">Cancelar</a>
</form>
{% endblock %}